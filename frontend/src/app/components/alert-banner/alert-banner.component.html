<!-- Loading State -->
<div class="alert-banner-container" *ngIf="loading">
  <div class="alert-banner loading-banner">
    <div class="spinner-small"></div>
    <span class="loading-text">Loading alerts...</span>
  </div>
</div>

<div class="alert-banner-container" *ngIf="!loading && alerts.length > 0 && summary && summary.total_active > 0">
  <div class="alert-banner" [ngClass]="getBannerClass()">
    <div class="alert-banner-header" (click)="toggleCollapse()">
      <div class="alert-banner-summary">
        <span class="alert-icon">ðŸ””</span>
        <div class="alert-counts">
          <span class="alert-total">{{ summary.total_active }} Active Alert{{ summary.total_active !== 1 ? 's' : '' }}</span>
          <span class="alert-breakdown" *ngIf="summary.by_severity.critical > 0">
            <span class="critical-badge">{{ summary.by_severity.critical }} Critical</span>
          </span>
          <span class="alert-breakdown" *ngIf="summary.by_severity.high > 0">
            <span class="high-badge">{{ summary.by_severity.high }} High</span>
          </span>
          <span class="alert-breakdown" *ngIf="summary.by_severity.medium > 0">
            <span class="medium-badge">{{ summary.by_severity.medium }} Medium</span>
          </span>
        </div>
      </div>
      <button class="collapse-btn" [attr.aria-expanded]="!isCollapsed">
        <span *ngIf="isCollapsed">â–¼</span>
        <span *ngIf="!isCollapsed">â–²</span>
      </button>
    </div>

    <div class="alert-banner-content" *ngIf="!isCollapsed">
      <div class="alert-list">
        <div 
          class="alert-item" 
          *ngFor="let alert of alerts.slice(0, 10)"
          [ngClass]="getSeverityClass(alert.Severity)">
          <div class="alert-item-header">
            <span class="alert-item-icon">{{ getAlertIcon(alert.AlertType) }}</span>
            <div class="alert-item-info">
              <div class="alert-item-title">
                <span class="alert-type-label">{{ getAlertTypeLabel(alert.AlertType) }}</span>
                <span class="severity-badge" [ngClass]="getSeverityClass(alert.Severity)">
                  {{ alert.Severity }}
                </span>
              </div>
              <div class="alert-item-message">{{ alert.AlertMessage || alert.Description }}</div>
              <div class="alert-item-time">{{ formatDate(alert.CreatedAt) }}</div>
            </div>
          </div>
          <button 
            class="resolve-btn" 
            (click)="resolveAlert(alert.AlertId, $event)"
            title="Mark as resolved">
            âœ“
          </button>
        </div>

        <div class="alert-footer" *ngIf="alerts.length > 10">
          <span class="more-alerts">
            +{{ alerts.length - 10 }} more alerts
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Alert Resolution Modal -->
<app-alert-resolution-modal
  [alert]="selectedAlert"
  [isOpen]="isModalOpen"
  (close)="closeModal()"
  (resolve)="onResolveAlert($event)">
</app-alert-resolution-modal>
