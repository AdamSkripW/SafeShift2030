<app-navbar></app-navbar>

<div class="new-shift-container">
  <div class="content-wrapper">
    <header class="page-header">
      <h1>{{ isEditMode ? 'Edit Shift' : 'Log Your Shift' }}</h1>
      <p class="subtitle">{{ isEditMode ? 'Update your shift details' : 'Track your work hours and well-being' }}</p>
    </header>

    <!-- Voice Dictation Section -->
    <div class="voice-dictation-section" [class.recording]="isRecording">
      <div class="voice-controls">
        <button 
          type="button" 
          class="btn-voice"
          [class.recording]="isRecording"
          [class.processing]="isProcessingVoice"
          [disabled]="isProcessingVoice"
          [style.background]="isRecording ? 'rgba(239, 68, 68, 0.6)' : (isProcessingVoice ? 'rgba(59, 130, 246, 0.6)' : 'rgba(255, 255, 255, 0.05)')"
          [style.border-color]="isRecording ? '#ef4444' : (isProcessingVoice ? '#3b82f6' : 'rgba(255, 255, 255, 0.2)')"
          [style.box-shadow]="isRecording ? '0 0 20px rgba(239, 68, 68, 0.5)' : (isProcessingVoice ? '0 0 20px rgba(59, 130, 246, 0.5)' : 'none')"
          (click)="isRecording ? stopVoiceRecording() : startVoiceRecording()"
        >
          <!-- Idle state -->
          <span class="voice-icon" *ngIf="!isRecording && !isProcessingVoice">üé§</span>
          
          <!-- Recording state -->
          <span class="voice-icon recording-pulse" *ngIf="isRecording">üî¥</span>
          
          <!-- Processing state -->
          <span class="voice-icon processing-spin" *ngIf="isProcessingVoice">‚öôÔ∏è</span>
          
          <!-- Button text -->
          <span *ngIf="!isRecording && !isProcessingVoice">üéôÔ∏è Start Voice Dictation</span>
          <span *ngIf="isRecording">üî¥ RECORDING</span>
          <span *ngIf="isProcessingVoice">‚è≥ Processing...</span>

          <!-- Audio wave animation when recording -->
          <div class="audio-wave" *ngIf="isRecording">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>
      </div>

      <!-- Voice prompt for missing fields -->
      <div class="voice-prompt" *ngIf="voicePrompt && !isProcessingVoice" style="background: rgba(251, 191, 36, 0.1); border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 12px;">
        <strong style="color: #f59e0b;">üé§ {{ voicePrompt }}</strong>
      </div>

      <div class="voice-error" *ngIf="voiceError">
        <strong>‚ùå Error:</strong> {{ voiceError }}
      </div>

      <div class="voice-hint" *ngIf="!isRecording && !isProcessingVoice">
        <small>üí° <strong>Example (speaking naturally):</strong></small>
        <small>"Last night shift 12 hours, very stressed, critical cases"</small>
        <br>
      </div>
    </div>

    <div class="error-banner" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <form [formGroup]="shiftForm" (ngSubmit)="onSubmit()" class="shift-form">
      
      <!-- Shift Date -->
      <div class="form-group">
        <label for="shiftDate" class="form-label">Shift Date *</label>
        <input
          type="date"
          id="shiftDate"
          formControlName="shiftDate"
          class="form-input"
          [class.invalid]="submitted && f['shiftDate'].errors"
        />
        <div class="error-message" *ngIf="submitted && f['shiftDate'].errors">
          <span *ngIf="f['shiftDate'].errors['required']">Shift date is required</span>
        </div>
      </div>

      <!-- Hours Slept Before -->
      <div class="form-group">
        <label for="hoursSleptBefore" class="form-label">
          Hours Slept Before Shift *
          <span class="label-hint">(0-24 hours)</span>
        </label>
        <input
          type="number"
          id="hoursSleptBefore"
          formControlName="hoursSleptBefore"
          class="form-input"
          [class.invalid]="submitted && f['hoursSleptBefore'].errors"
          min="0"
          max="24"
          step="0.5"
        />
        <div class="error-message" *ngIf="submitted && f['hoursSleptBefore'].errors">
          <span *ngIf="f['hoursSleptBefore'].errors['required']">Hours slept is required</span>
          <span *ngIf="f['hoursSleptBefore'].errors['min'] || f['hoursSleptBefore'].errors['max']">
            Must be between 0 and 24 hours
          </span>
        </div>
      </div>

      <!-- Shift Type -->
      <div class="form-group">
        <label for="shiftType" class="form-label">Shift Type *</label>
        <select
          id="shiftType"
          formControlName="shiftType"
          class="form-input"
          [class.invalid]="submitted && f['shiftType'].errors"
        >
          <option *ngFor="let type of shiftTypes" [value]="type">
            {{ type | titlecase }}
          </option>
        </select>
        <div class="error-message" *ngIf="submitted && f['shiftType'].errors">
          <span *ngIf="f['shiftType'].errors['required']">Shift type is required</span>
        </div>
      </div>

      <!-- Shift Length -->
      <div class="form-group">
        <label for="shiftLengthHours" class="form-label">
          Shift Length *
          <span class="label-hint">(hours)</span>
        </label>
        <input
          type="number"
          id="shiftLengthHours"
          formControlName="shiftLengthHours"
          class="form-input"
          [class.invalid]="submitted && f['shiftLengthHours'].errors"
          min="1"
          max="24"
          step="0.5"
        />
        <div class="error-message" *ngIf="submitted && f['shiftLengthHours'].errors">
          <span *ngIf="f['shiftLengthHours'].errors['required']">Shift length is required</span>
          <span *ngIf="f['shiftLengthHours'].errors['min'] || f['shiftLengthHours'].errors['max']">
            Must be between 1 and 24 hours
          </span>
        </div>
      </div>

      <!-- Patients Count -->
      <div class="form-group">
        <label for="patientsCount" class="form-label">
          Number of Patients *
        </label>
        <input
          type="number"
          id="patientsCount"
          formControlName="patientsCount"
          class="form-input"
          [class.invalid]="submitted && f['patientsCount'].errors"
          min="0"
        />
        <div class="error-message" *ngIf="submitted && f['patientsCount'].errors">
          <span *ngIf="f['patientsCount'].errors['required']">Patient count is required</span>
          <span *ngIf="f['patientsCount'].errors['min']">Must be 0 or greater</span>
        </div>
      </div>

      <!-- Stress Level -->
      <div class="form-group">
        <label for="stressLevel" class="form-label">
          Stress Level *
          <span class="label-hint">(1 = Low, 10 = Extreme)</span>
        </label>
        <div class="stress-level-container">
          <input
            type="range"
            id="stressLevel"
            formControlName="stressLevel"
            class="stress-slider"
            min="1"
            max="10"
            step="1"
          />
          <div class="stress-value">{{ f['stressLevel'].value }}</div>
        </div>
        <div class="stress-labels">
          <span>Low</span>
          <span>Moderate</span>
          <span>High</span>
          <span>Extreme</span>
        </div>
        <div class="error-message" *ngIf="submitted && f['stressLevel'].errors">
          <span *ngIf="f['stressLevel'].errors['required']">Stress level is required</span>
        </div>
      </div>

      <!-- Shift Note -->
      <div class="form-group">
        <label for="shiftNote" class="form-label">
          Notes (Optional)
        </label>
        <textarea
          id="shiftNote"
          formControlName="shiftNote"
          class="form-input form-textarea"
          rows="4"
          placeholder="Any important events, challenges, or observations..."
        ></textarea>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="onCancel()" [disabled]="loading">
          Cancel
        </button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          <span *ngIf="!loading">{{ isEditMode ? 'Update Shift' : 'Save Shift' }}</span>
          <span *ngIf="loading">{{ isEditMode ? 'Updating...' : 'Saving...' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>
