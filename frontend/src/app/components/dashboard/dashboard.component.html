<app-navbar></app-navbar>

<div class="dashboard-container">
  <div class="content-wrapper">

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading your dashboard...</p>
    </div>

    <!-- Error Message -->
    <div class="error-banner" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="!loading">

      <!-- Welcome Header -->
      <header class="welcome-header">
        <div>
          <h1>{{ getGreeting() }}, {{ (userProfile?.fullName || 'there').split(' ')[0] }}!</h1>
          <p class="subtitle">Here's your well-being overview</p>
        </div>
        <button class="btn-primary" (click)="createNewShift()">
          ‚ûï Log New Shift
        </button>
      </header>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <div class="stat-value">{{ totalShifts }}</div>
            <div class="stat-label">Total Shifts</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üò∞</div>
          <div class="stat-content">
            <div class="stat-value">{{ averageStress }}/10</div>
            <div class="stat-label">Avg Stress</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üò¥</div>
          <div class="stat-content">
            <div class="stat-value">{{ averageSleep }}h</div>
            <div class="stat-label">Avg Sleep</div>
          </div>
        </div>

        <div class="stat-card" [ngClass]="getZoneClass(currentZone)">
          <div class="stat-icon">üéØ</div>
          <div class="stat-content">
            <div class="stat-value">{{ currentZone | titlecase }}</div>
            <div class="stat-label">Current Zone</div>
          </div>
        </div>
      </div>

      <!-- Stress Graph -->
      <div class="graph-section">
        <div class="section-header">
          <h2>Stress Level Trend</h2>
          <span class="section-subtitle">Last 7 shifts</span>
        </div>

        <!-- Empty State -->
        <div class="empty-graph" *ngIf="stressData.length === 0">
          <div class="empty-icon">üìà</div>
          <h3>No data yet</h3>
          <p>Start logging shifts to see your stress trends</p>
          <button class="btn-secondary" (click)="createNewShift()">
            Log Your First Shift
          </button>
        </div>

        <!-- Stress Bar Chart -->
        <div class="stress-chart" *ngIf="stressData.length > 0">
          <div class="chart-container">
            <!-- Y-axis labels -->
            <div class="y-axis">
              <span class="y-label">10</span>
              <span class="y-label">8</span>
              <span class="y-label">6</span>
              <span class="y-label">4</span>
              <span class="y-label">2</span>
              <span class="y-label">0</span>
            </div>

            <!-- Chart bars -->
            <div class="chart-bars">
              <div class="bar-wrapper" *ngFor="let data of stressData">
                <div class="bar-container">
                  <div 
                    class="bar" 
                    [style.height.%]="getBarHeight(data.stressLevel)"
                    [style.background-color]="getStressColor(data.stressLevel)"
                    [title]="'Stress: ' + data.stressLevel + '/10'"
                  >
                    <span class="bar-value">{{ data.stressLevel }}</span>
                  </div>
                </div>
                <div class="bar-label">{{ data.displayDate }}</div>
              </div>
            </div>
          </div>

          <!-- Legend -->
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color" style="background-color: #48bb78;"></span>
              <span>Low (1-3)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background-color: #ecc94b;"></span>
              <span>Moderate (4-6)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background-color: #f56565;"></span>
              <span>High (7-10)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Latest Shift Insight -->
      <div class="insight-section" *ngIf="latestShift">
        <div class="section-header">
          <h2>Latest Shift Insight</h2>
          <button class="btn-link" (click)="viewAllShifts()">View All ‚Üí</button>
        </div>

        <div class="insight-card">
          <div class="insight-header">
            <div class="insight-date">
              <span class="date-icon">{{ latestShift.shiftType === 'night' ? 'üåô' : '‚òÄÔ∏è' }}</span>
              <span>{{ formatShortDate(latestShift.shiftDate) }}</span>
            </div>
            <span class="zone-badge" [ngClass]="getZoneClass(latestShift.zone)">
              {{ latestShift.zone || 'N/A' }}
            </span>
          </div>

          <div class="insight-stats">
            <div class="insight-stat">
              <span class="stat-label">SafeShift Index</span>
              <span class="stat-value" [ngClass]="getZoneClass(latestShift.zone)">
                {{ latestShift.safeShiftIndex || 'N/A' }}
              </span>
            </div>
            <div class="insight-stat">
              <span class="stat-label">Sleep</span>
              <span class="stat-value">{{ latestShift.hoursSleptBefore }}h</span>
            </div>
            <div class="insight-stat">
              <span class="stat-label">Stress</span>
              <span class="stat-value">{{ latestShift.stressLevel }}/10</span>
            </div>
          </div>

          <div class="insight-ai" *ngIf="latestShift.aiExplanation">
            <h4>Analysis</h4>
            <p>{{ latestShift.aiExplanation }}</p>
          </div>

          <div class="insight-ai" *ngIf="latestShift.aiTips">
            <h4>Recommendations</h4>
            <p style="white-space: pre-line;">{{ latestShift.aiTips }}</p>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button class="action-card" (click)="createNewShift()">
          <span class="action-icon">‚ûï</span>
          <span class="action-text">Log New Shift</span>
        </button>
        <button class="action-card" (click)="viewAllShifts()">
          <span class="action-icon">üìã</span>
          <span class="action-text">View All Shifts</span>
        </button>
      </div>

    </div>
  </div>
</div>
